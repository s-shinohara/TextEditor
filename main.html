<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<style>
#editorOuterbox {
  width: 100%;
  background: #FFF;
  
  position: fixed;
  top: 0;
  left: 0;
  
  height: 2em;
}
  
#bOuterbox {
  margin: 8em 0 0;
}
</style>

</head>
<body>

<div id="editorOuterbox">
<form id="editor" name="editor">
<div id="textBeingEditedOuterbox">
  <textarea id="textBeingEdited" rows="1" cols="5" onChange="copy()"></textarea>
</div>
<div id="startOuterbox">
  <input type="number" id="startNum" defaultvalue="0" placeholder="0" />
  <input type="button" class="setSelectionRange start back" value=" < " />
  <input type="number" id="startNumberDelta" defaultvalue="0" placeholder="0" />
  <input type="button" class="setSelectionRange start forward" value=" > " />
</div>
<div id="endOuterbox">
  <input type="number" id="endNum" defaultvalue="0" placeholder="0" />
  <input type="button" class="setSelectionRange end back" value=" < ">
  <input type="number" id="endNumberDelta" defaultvalue="0" placeholder="0" />
  <input type="button" class="setSelectionRange end forward" value=" > ">
</div>
<div id="replaceOuterbox">
  <input type="button" id="replace" value="replace" />
  <input type="text" id="replaceTo" placeholder="hogehoge" />
</div>
</form>
</div>
  
<div id="bOuterbox">
  <div id="b">
  </div>
</div>
  
<script>
function copy() {
  var elementB = document.getElementById("b");
  elementB.textContent = document.getElementById("textBeingEdited").value;
}

function changeSelectionRange(startOrEnd, backOrForward) {
  var elementTextBeingEdited = document.getElementById("textBeingEdited");
  var elementStartNumberDelta = document.getElementById("startNumberDelta");
  var elementEndNumberDelta = document.getElementById("endNumberDelta");
  var selectionStart = elementTextBeingEdited.selectionStart;
  var selectionEnd = elementTextBeingEdited.selectionEnd;
  var delta;
  
  if (startOrEnd == "start") {
    delta = elementStartNumberDelta.value;
  } else if (startOrEnd == "end") {
    delta = elementEndNumberDelta.value;
  }
  
  if (backOrForward == "back") {
    delta = -1 * delta;
  }
  
  if (startOrEnd == "start") {
    selectionStart = selectionStart + delta;
    if (selectionStart < 0) selectionStart = 0;
    if (selectionEnd < selectionStart) selectionEnd = selectionStart;
  } else if (startOrEnd == "end") {
    selectionEnd = selectionEnd + delta;
    if (selectionEnd < selectionStart) selectionEnd = selectionStart;
  }
  elementTextBeingEdited.setSelectionRange(selectionStart, selectionEnd);
  elementTextBeingEdited.focus();
  
  var elementStartNum;
  var elementEndNum;
  
  elementStartNum = document.getElementById("startNum");
  elementEndNum = document.getElementById("endNum");

  elementStartNum.textContent = selectionStart;
  elementEndNum.textContent = selectionEnd;
}
  
window.onload = (function() {
  var startOrEnd;
  var backOrForward;
  
  var elementArray;
  var element;

  elementArray = document.getElementsByTagName("input");
  
  for(var i = 0; i < elementArray.length; i++) {
    element = elementArray[i];
    
    var classNames = element.className.split(" ");
    
    if (isStringInStringArray("setSelectionRange", classNames)) {
      if (isStringInStringArray("start", classNames)) {
        startOrEnd = "start";
      } else if (isStringInStringArray("end", classNames)) {
        startOrEnd = "end";
      }

      if (isStringInStringArray("back", classNames)) {
        backOrForward = "back";
      } else if (isStringInStringArray("forward", classNames)) {
        backOrForward = "forward";
      }
      
      element.onclick = function() {
        var soe = startOrEnd;
        var bof = backOrForward;
        return changeSelectionRange(soe, bof);
      };
    }
  }
  
  if (element.id == "replace") {
    element.onclick = function() {
      var textBeingEdited = document.getElementById("textBeingEdited");
      textBeingEdited.value = document.getElementById("replaceTo").value;
    };
  }
})();
  
function isStringInStringArray(str, strArray) {
  var i;
  for (i = 0; i < strArray.length; i++) {
    if (str == strArray[i]) return true;
  }
  
  return false;
}
  
</script>

</body>
</html>
